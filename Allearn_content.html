<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allearn | Sheet Content</title>

<link rel="stylesheet" href="Allearn_header.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  background:#f5f7fa;
  background-image: linear-gradient(#e0e7ef 1px, transparent 1px);
  background-size: 100% 40px;
}

.main-wrapper{
  max-width:1000px;
  margin:40px auto;
  padding:20px;
}

.sheet-card{
  background:#fff9e6;
  border-radius:30px;
  padding:40px;
  display:flex;
  gap:30px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
  margin-bottom:30px;
}

.sheet-preview img{
  width:240px;
  border-radius:20px;
}

.speech{
  position:relative;
  background:#4a7599;
  padding:20px 25px;
  border-radius:20px;
  margin-bottom:15px;
  color:white;
  display:inline-block;
}

.speech::after{
  content:"";
  position:absolute;
  left:-10px;
  top:25px;
  border-top:10px solid transparent;
  border-bottom:10px solid transparent;
  border-right:12px solid #4a7599;
}

.tags{display:flex;gap:10px;margin-bottom:15px}
.tag{
  padding:5px 15px;
  border-radius:20px;
  font-size:13px;
  color:white;
  font-weight:bold;
}

.blue{ background:#2f6bff; color:#fff }
.yellow{ background:#f7d046; color:#000 }
.babyblue{background:#b1e4eb; color:#000;}

.description-box{
  font-size:18px;
  line-height:1.6;
}

.pdf-container{
  background:white;
  padding:15px;
  border-radius:30px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
  margin-bottom:30px;
}

.pdf-viewer{
  width:100%;
  height:600px;
  border:none;
  border-radius:20px;
}

/* ===== COMMENTS ===== */
.comment-section {
  padding: 30px 40px;
  background: white;
}

.comment-section h2 {
  margin-bottom: 15px;
}

.comment-box textarea {
  width: 100%;
  height: 90px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  resize: none;
  font-family: inherit;
}

.comment-box button {
  margin-top: 10px;
  padding: 8px 22px;
  border-radius: 20px;
  border: none;
  background: #4a90e2;
  color: white;
  cursor: pointer;
}

.comment-list {
  margin-top: 20px;
}

.comment-item {
  padding: 12px 16px;
  background: #f2f4f8;
  border-radius: 10px;
  margin-bottom: 10px;
}

.comment-item strong {
  display: block;
  margin-bottom: 4px;
}

</style>
</head>

<body>

<div id="header"></div>

<div class="main-wrapper">

<section class="sheet-card">
  <div class="sheet-preview">
    <img src="Exsheet.png">
  </div>

  <div class="sheet-meta">
    <div class="speech">
      <h1 id="sheetName">กำลังโหลด...</h1>
    </div>

    <div class="tags">
      <span class="tag yellow" id="subjectTag">-</span>
      <span class="tag babyblue" id="majorTag">-</span>
    </div>

    <div class="description-box" id="sheetDesc"></div>
  </div>
</section>

<section class="pdf-container">
  <iframe id="pdfViewer" class="pdf-viewer"></iframe>
</section>

</div>

<script>
/* ===== LOAD HEADER ===== */
fetch("Allearn_header.html")
  .then(r=>r.text())
  .then(t=>document.getElementById("header").innerHTML=t)

/* ===== SUPABASE ===== */
const supabaseClient = supabase.createClient(
  "https://ctfrqwehpvpldtiojedb.supabase.co",
  "sb_publishable_YHDQnG7VsNgb4O4i6MPN5g_lgU5eOGI"
)

/* ===== GET IDSHEET FROM URL ===== */
const params = new URLSearchParams(window.location.search)
const IDSHEET = params.get("idsheet")

if(!IDSHEET){
  alert("ไม่พบ idsheet")
}

/* ===== ELEMENT ===== */
const sheetName = document.getElementById("sheetName")
const sheetDesc = document.getElementById("sheetDesc")
const subjectTag = document.getElementById("subjectTag")
const majorTag = document.getElementById("majorTag")
const pdfViewer = document.getElementById("pdfViewer")

/* ===== LOAD SHEET ===== */
async function loadSheet(){
  const { data, error } = await supabaseClient
    .from("Sheet")
    .select("sheet_name, description, file_path, idsubject, idmajor")
    .eq("idsheet", IDSHEET)
    .single()

  if(error || !data){
    alert("โหลดข้อมูลชีทไม่สำเร็จ")
    return
  }

  sheetName.textContent = data.sheet_name
  sheetDesc.textContent = data.description
  subjectTag.textContent = data.idsubject
  majorTag.textContent = data.idmajor

  const { data:pdf } = supabaseClient
    .storage
    .from("sheet-pdf")
    .getPublicUrl(data.file_path)

  pdfViewer.src = pdf.publicUrl
}

loadSheet()
</script>

<!-- ===== COMMENTS ===== -->
<section class="comment-section"> 
  <h2>คอมเมนต์</h2>

  <div class="comment-box">
    <textarea id="commentText" placeholder="แสดงความคิดเห็นเกี่ยวกับชีทนี้..."></textarea><br>
    <button onclick="sendComment()">ส่งคอมเมนต์</button>
  </div>
</section>



</body>
</html>
