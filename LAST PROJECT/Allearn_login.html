<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allearn - Login & Signup</title>
    <style>
        /* --- CSS Design (‡∏ò‡∏µ‡∏° Allearn) --- */
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #b1c6e1;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 39px, #8fa9c9 39px, #8fa9c9 41px);
            font-family: 'Times New Roman', 'Sarabun', serif;
        }

        .login-container {
            background-color: #fff9e6;
            width: 100%;
            max-width: 420px;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            box-sizing: border-box;
            margin: 20px;
        }

        .logo { width: 100px; margin-bottom: 20px; }

        h2 { color: #4a7599; margin-bottom: 25px; font-size: 28px; }

        .form-group { text-align: left; margin-bottom: 15px; }

        label {
            display: block;
            color: #4a7599;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background-color: white;
            box-sizing: border-box;
            font-size: 16px;
            outline: none;
        }

        input:focus { border-color: #4a7599; }

        .login-btn {
            background-color: #f0706a;
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: 0.3s;
        }

        .login-btn:hover { background-color: #d95d57; }

        .link-text {
            display: block;
            margin-top: 20px;
            color: #4a7599;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="login-container">
        <img src="logolearn.png" alt="Allearn Logo" class="logo">

        <div id="loginBox">
            <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <div class="form-group">
                <label>Username (Email)</label>
                <input id="loginEmail" type="email" placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input id="loginPassword" type="password" placeholder="******">
            </div>
            <button class="login-btn" onclick="login()">LOGIN</button>
            <span class="link-text" onclick="showSignup()">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
        </div>

        <div id="signupBox" style="display:none">
            <h2>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
            <div class="form-group">
                <label>Email</label>
                <input id="email" type="email" placeholder="email">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                    <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
                </div>
                <div class="form-group">
                    <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input id="surname" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                </div>
            </div>
            <div class="form-group">
                <label>‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                <select id="idmajor">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>
                </select>
            </div>
            <div class="form-group">
                <label>‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
                <select id="idyear">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ --</option>
                </select>
            </div>
            <button class="login-btn" onclick="signUp()">SIGN UP</button>
            <span class="link-text" onclick="showLogin()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseClient = supabase.createClient(
            'https://ctfrqwehpvpldtiojedb.supabase.co',
            'sb_publishable_YHDQnG7VsNgb4O4i6MPN5g_lgU5eOGI'
        )

        const loginBox = document.getElementById('loginBox');
        const signupBox = document.getElementById('signupBox');

        function showSignup() {
            loginBox.style.display = "none";
            signupBox.style.display = "block";
        }

        function showLogin() {
            signupBox.style.display = "none";
            loginBox.style.display = "block";
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dropdown ‡∏à‡∏≤‡∏Å Supabase
        async function loadDropdowns() {
            const { data: majors } = await supabaseClient.from('Major').select('idmajor, major_name').order('major_name');
            majors?.forEach(m => {
                document.getElementById('idmajor').innerHTML += `<option value="${m.idmajor}">${m.major_name}</option>`;
            });

            const { data: years } = await supabaseClient.from('Year').select('idyear, year').order('idyear');
            years?.forEach(y => {
                document.getElementById('idyear').innerHTML += `<option value="${y.idyear}">${y.year}</option>`;
            });
        }
        loadDropdowns();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô LOGIN
        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!email || !password) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å email ‡πÅ‡∏•‡∏∞ password");
                return;
            }

            const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
            if (error) { alert(error.message); return; }

            alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ");
            // window.location.href = "dashboard.html"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á login
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô SIGN UP
        async function signUp() {
            const emailVal = document.getElementById('email').value.trim();
            const passVal = document.getElementById('password').value.trim();
            const nameVal = document.getElementById('name').value.trim();
            const surnameVal = document.getElementById('surname').value.trim();
            const majorVal = document.getElementById('idmajor').value;
            const yearVal = document.getElementById('idyear').value;

            if (!emailVal || !passVal || !nameVal || !surnameVal || !majorVal || !yearVal) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á");
                return;
            }

            const { data, error } = await supabaseClient.auth.signUp({ email: emailVal, password: passVal });
            if (error) { alert(error.message); return; }

            const userId = data.user.id;
            const { error: dbError } = await supabaseClient
                .from('Account')
                .insert({
                    idacc: userId,
                    name: nameVal,
                    surname: surnameVal,
                    idmajor: majorVal,
                    idyear: yearVal
                });

            if (dbError) { alert(dbError.message); return; }

            alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Email ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)");
            showLogin();
        }
    </script>
</body>
</html>
